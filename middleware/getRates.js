var request = require('request');


/*


[{"currency":"GBP","exchangeRates":[{"currency":"EUR","conversionRate":1.5,"validFrom":"2016-05-06T00:00:00.0000000+01:00","validTo":"2016-05-07T00:00:00.0000000+01:00"}]}]


*/


var data = [{
        "currency":"GBP",
        "exchangeRates":[
            {"currency":"EUR","conversionRate":[
          {"rate": 0.0185197704},
          {"rate": -0.2814802296},
          {"rate": -0.6814802296},
          {"rate": -0.7814802296},
          {"rate": -0.1814802296},
          {"rate": -0.5814802296},
          {"rate": -0.1814802296},
          {"rate": -0.2814802296},
          {"rate": -0.8814802296},
          {"rate": -0.3814802296},
          {"rate": -0.3814802296},
          {"rate": -0.4814802296},
          {"rate": -0.7814802296},
          {"rate": -0.6814802296},
          {"rate": -0.0814802296},
          {"rate": -0.0814802296}
        ],"validFrom":"2016-05-06T00:00:00.0000000+01:00","validTo":"2016-05-07T00:00:00.0000000+01:00"},
            {"currency":"PHP","conversionRate":[
          {"rate": 0.0185197704},
          {"rate": -0.2814802296},
          {"rate": -0.6814802296},
          {"rate": -0.7814802296},
          {"rate": -0.1814802296},
          {"rate": -0.5814802296},
          {"rate": -0.1814802296},
          {"rate": -0.2814802296},
          {"rate": -0.8814802296},
          {"rate": -0.3814802296},
          {"rate": -0.3814802296},
          {"rate": -0.4814802296},
          {"rate": -0.7814802296},
          {"rate": -0.6814802296},
          {"rate": -0.0814802296},
          {"rate": -0.0814802296}
        ],"validFrom":"2016-05-06T00:00:00.0000000+01:00","validTo":"2016-05-07T00:00:00.0000000+01:00"},
            {"currency":"NGN","conversionRate":[
          {"rate": 0.0185197704},
          {"rate": -0.2814802296},
          {"rate": -0.6814802296},
          {"rate": -0.7814802296},
          {"rate": -0.1814802296},
          {"rate": -0.5814802296},
          {"rate": -0.1814802296},
          {"rate": -0.2814802296},
          {"rate": -0.8814802296},
          {"rate": -0.3814802296},
          {"rate": -0.3814802296},
          {"rate": -0.4814802296},
          {"rate": -0.7814802296},
          {"rate": -0.6814802296},
          {"rate": -0.0814802296},
          {"rate": -0.0814802296}
        ],"validFrom":"2016-05-06T00:00:00.0000000+01:00","validTo":"2016-05-07T00:00:00.0000000+01:00"},
            {"currency":"AUD","conversionRate":[
          {"rate": 0.0185197704},
          {"rate": -0.2814802296},
          {"rate": -0.6814802296},
          {"rate": -0.7814802296},
          {"rate": -0.1814802296},
          {"rate": -0.5814802296},
          {"rate": -0.1814802296},
          {"rate": -0.2814802296},
          {"rate": -0.8814802296},
          {"rate": -0.3814802296},
          {"rate": -0.3814802296},
          {"rate": -0.4814802296},
          {"rate": -0.7814802296},
          {"rate": -0.6814802296},
          {"rate": -0.0814802296},
          {"rate": -0.0814802296}
        ],"validFrom":"2016-05-06T00:00:00.0000000+01:00","validTo":"2016-05-07T00:00:00.0000000+01:00"}
        ]
    },

    {
        "currency":"PHP",
        "exchangeRates":[
            {"currency":"EUR","conversionRate":[
          {"rate": 0.0185197704},
          {"rate": -0.2814802296},
          {"rate": -0.6814802296},
          {"rate": -0.7814802296},
          {"rate": -0.1814802296},
          {"rate": -0.5814802296},
          {"rate": -0.1814802296},
          {"rate": -0.2814802296},
          {"rate": -0.8814802296},
          {"rate": -0.3814802296},
          {"rate": -0.3814802296},
          {"rate": -0.4814802296},
          {"rate": -0.7814802296},
          {"rate": -0.6814802296},
          {"rate": -0.0814802296},
          {"rate": -0.0814802296}
        ],"validFrom":"2016-05-06T00:00:00.0000000+01:00","validTo":"2016-05-07T00:00:00.0000000+01:00"},
            {"currency":"NGN","conversionRate":[
          {"rate": 0.0185197704},
          {"rate": -0.2814802296},
          {"rate": -0.6814802296},
          {"rate": -0.7814802296},
          {"rate": -0.1814802296},
          {"rate": -0.5814802296},
          {"rate": -0.1814802296},
          {"rate": -0.2814802296},
          {"rate": -0.8814802296},
          {"rate": -0.3814802296},
          {"rate": -0.3814802296},
          {"rate": -0.4814802296},
          {"rate": -0.7814802296},
          {"rate": -0.6814802296},
          {"rate": -0.0814802296},
          {"rate": -0.0814802296}
        ],"validFrom":"2016-05-06T00:00:00.0000000+01:00","validTo":"2016-05-07T00:00:00.0000000+01:00"},
            {"currency":"AUD","conversionRate":[
          {"rate": 0.0185197704},
          {"rate": -0.2814802296},
          {"rate": -0.6814802296},
          {"rate": -0.7814802296},
          {"rate": -0.1814802296},
          {"rate": -0.5814802296},
          {"rate": -0.1814802296},
          {"rate": -0.2814802296},
          {"rate": -0.8814802296},
          {"rate": -0.3814802296},
          {"rate": -0.3814802296},
          {"rate": -0.4814802296},
          {"rate": -0.7814802296},
          {"rate": -0.6814802296},
          {"rate": -0.0814802296},
          {"rate": -0.0814802296}
        ],"validFrom":"2016-05-06T00:00:00.0000000+01:00","validTo":"2016-05-07T00:00:00.0000000+01:00"},
            {"currency":"GBP","conversionRate":[
          {"rate": 0.0185197704},
          {"rate": -0.2814802296},
          {"rate": -0.6814802296},
          {"rate": -0.7814802296},
          {"rate": -0.1814802296},
          {"rate": -0.5814802296},
          {"rate": -0.1814802296},
          {"rate": -0.2814802296},
          {"rate": -0.8814802296},
          {"rate": -0.3814802296},
          {"rate": -0.3814802296},
          {"rate": -0.4814802296},
          {"rate": -0.7814802296},
          {"rate": -0.6814802296},
          {"rate": -0.0814802296},
          {"rate": -0.0814802296}
        ],"validFrom":"2016-05-06T00:00:00.0000000+01:00","validTo":"2016-05-07T00:00:00.0000000+01:00"}
    ]
},  {
        "currency":"EUR",
        "exchangeRates":[
            {"currency":"PHP","conversionRate":[
          {"rate": 0.0185197704},
          {"rate": -0.2814802296},
          {"rate": -0.6814802296},
          {"rate": -0.7814802296},
          {"rate": -0.1814802296},
          {"rate": -0.5814802296},
          {"rate": -0.1814802296},
          {"rate": -0.2814802296},
          {"rate": -0.8814802296},
          {"rate": -0.3814802296},
          {"rate": -0.3814802296},
          {"rate": -0.4814802296},
          {"rate": -0.7814802296},
          {"rate": -0.6814802296},
          {"rate": -0.0814802296},
          {"rate": -0.0814802296}
        ],"validFrom":"2016-05-06T00:00:00.0000000+01:00","validTo":"2016-05-07T00:00:00.0000000+01:00"},
            {"currency":"NGN","conversionRate":[
          {"rate": 0.0185197704},
          {"rate": -0.2814802296},
          {"rate": -0.6814802296},
          {"rate": -0.7814802296},
          {"rate": -0.1814802296},
          {"rate": -0.5814802296},
          {"rate": -0.1814802296},
          {"rate": -0.2814802296},
          {"rate": -0.8814802296},
          {"rate": -0.3814802296},
          {"rate": -0.3814802296},
          {"rate": -0.4814802296},
          {"rate": -0.7814802296},
          {"rate": -0.6814802296},
          {"rate": -0.0814802296},
          {"rate": -0.0814802296}
        ],"validFrom":"2016-05-06T00:00:00.0000000+01:00","validTo":"2016-05-07T00:00:00.0000000+01:00"},
            {"currency":"AUD","conversionRate":[
          {"rate": 0.0185197704},
          {"rate": -0.2814802296},
          {"rate": -0.6814802296},
          {"rate": -0.7814802296},
          {"rate": -0.1814802296},
          {"rate": -0.5814802296},
          {"rate": -0.1814802296},
          {"rate": -0.2814802296},
          {"rate": -0.8814802296},
          {"rate": -0.3814802296},
          {"rate": -0.3814802296},
          {"rate": -0.4814802296},
          {"rate": -0.7814802296},
          {"rate": -0.6814802296},
          {"rate": -0.0814802296},
          {"rate": -0.0814802296}
        ],"validFrom":"2016-05-06T00:00:00.0000000+01:00","validTo":"2016-05-07T00:00:00.0000000+01:00"},
            {"currency":"GBP","conversionRate":[
          {"rate": 0.0185197704},
          {"rate": -0.2814802296},
          {"rate": -0.6814802296},
          {"rate": -0.7814802296},
          {"rate": -0.1814802296},
          {"rate": -0.5814802296},
          {"rate": -0.1814802296},
          {"rate": -0.2814802296},
          {"rate": -0.8814802296},
          {"rate": -0.3814802296},
          {"rate": -0.3814802296},
          {"rate": -0.4814802296},
          {"rate": -0.7814802296},
          {"rate": -0.6814802296},
          {"rate": -0.0814802296},
          {"rate": -0.0814802296}
        ],"validFrom":"2016-05-06T00:00:00.0000000+01:00","validTo":"2016-05-07T00:00:00.0000000+01:00"}
    ]
},
{
        "currency":"NGN",
        "exchangeRates":[
            {"currency":"EUR","conversionRate":[
          {"rate": 0.0185197704},
          {"rate": -0.2814802296},
          {"rate": -0.6814802296},
          {"rate": -0.7814802296},
          {"rate": -0.1814802296},
          {"rate": -0.5814802296},
          {"rate": -0.1814802296},
          {"rate": -0.2814802296},
          {"rate": -0.8814802296},
          {"rate": -0.3814802296},
          {"rate": -0.3814802296},
          {"rate": -0.4814802296},
          {"rate": -0.7814802296},
          {"rate": -0.6814802296},
          {"rate": -0.0814802296},
          {"rate": -0.0814802296}
        ],"validFrom":"2016-05-06T00:00:00.0000000+01:00","validTo":"2016-05-07T00:00:00.0000000+01:00"},
            {"currency":"PHP","conversionRate":[
          {"rate": 0.0185197704},
          {"rate": -0.2814802296},
          {"rate": -0.6814802296},
          {"rate": -0.7814802296},
          {"rate": -0.1814802296},
          {"rate": -0.5814802296},
          {"rate": -0.1814802296},
          {"rate": -0.2814802296},
          {"rate": -0.8814802296},
          {"rate": -0.3814802296},
          {"rate": -0.3814802296},
          {"rate": -0.4814802296},
          {"rate": -0.7814802296},
          {"rate": -0.6814802296},
          {"rate": -0.0814802296},
          {"rate": -0.0814802296}
        ],"validFrom":"2016-05-06T00:00:00.0000000+01:00","validTo":"2016-05-07T00:00:00.0000000+01:00"},
            {"currency":"AUS","conversionRate":[
          {"rate": 0.0185197704},
          {"rate": -0.2814802296},
          {"rate": -0.6814802296},
          {"rate": -0.7814802296},
          {"rate": -0.1814802296},
          {"rate": -0.5814802296},
          {"rate": -0.1814802296},
          {"rate": -0.2814802296},
          {"rate": -0.8814802296},
          {"rate": -0.3814802296},
          {"rate": -0.3814802296},
          {"rate": -0.4814802296},
          {"rate": -0.7814802296},
          {"rate": -0.6814802296},
          {"rate": -0.0814802296},
          {"rate": -0.0814802296}
        ],"validFrom":"2016-05-06T00:00:00.0000000+01:00","validTo":"2016-05-07T00:00:00.0000000+01:00"},
            {"currency":"GBP","conversionRate":[
          {"rate": 0.0185197704},
          {"rate": -0.2814802296},
          {"rate": -0.6814802296},
          {"rate": -0.7814802296},
          {"rate": -0.1814802296},
          {"rate": -0.5814802296},
          {"rate": -0.1814802296},
          {"rate": -0.2814802296},
          {"rate": -0.8814802296},
          {"rate": -0.3814802296},
          {"rate": -0.3814802296},
          {"rate": -0.4814802296},
          {"rate": -0.7814802296},
          {"rate": -0.6814802296},
          {"rate": -0.0814802296},
          {"rate": -0.0814802296}
        ],"validFrom":"2016-05-06T00:00:00.0000000+01:00","validTo":"2016-05-07T00:00:00.0000000+01:00"}
    ]
},
{
        "currency":"AUD",
        "exchangeRates":[
            {"currency":"EUR","conversionRate":[
          {"rate": 0.0185197704},
          {"rate": -0.2814802296},
          {"rate": -0.6814802296},
          {"rate": -0.7814802296},
          {"rate": -0.1814802296},
          {"rate": -0.5814802296},
          {"rate": -0.1814802296},
          {"rate": -0.2814802296},
          {"rate": -0.8814802296},
          {"rate": -0.3814802296},
          {"rate": -0.3814802296},
          {"rate": -0.4814802296},
          {"rate": -0.7814802296},
          {"rate": -0.6814802296},
          {"rate": -0.0814802296},
          {"rate": -0.0814802296}
        ],"validFrom":"2016-05-06T00:00:00.0000000+01:00","validTo":"2016-05-07T00:00:00.0000000+01:00"},
            {"currency":"PHP","conversionRate":[
          {"rate": 0.0185197704},
          {"rate": -0.2814802296},
          {"rate": -0.6814802296},
          {"rate": -0.7814802296},
          {"rate": -0.1814802296},
          {"rate": -0.5814802296},
          {"rate": -0.1814802296},
          {"rate": -0.2814802296},
          {"rate": -0.8814802296},
          {"rate": -0.3814802296},
          {"rate": -0.3814802296},
          {"rate": -0.4814802296},
          {"rate": -0.7814802296},
          {"rate": -0.6814802296},
          {"rate": -0.0814802296},
          {"rate": -0.0814802296}
        ],"validFrom":"2016-05-06T00:00:00.0000000+01:00","validTo":"2016-05-07T00:00:00.0000000+01:00"},
            {"currency":"NGN","conversionRate":[
          {"rate": 0.0185197704},
          {"rate": -0.2814802296},
          {"rate": -0.6814802296},
          {"rate": -0.7814802296},
          {"rate": -0.1814802296},
          {"rate": -0.5814802296},
          {"rate": -0.1814802296},
          {"rate": -0.2814802296},
          {"rate": -0.8814802296},
          {"rate": -0.3814802296},
          {"rate": -0.3814802296},
          {"rate": -0.4814802296},
          {"rate": -0.7814802296},
          {"rate": -0.6814802296},
          {"rate": -0.0814802296},
          {"rate": -0.0814802296}
        ],"validFrom":"2016-05-06T00:00:00.0000000+01:00","validTo":"2016-05-07T00:00:00.0000000+01:00"},
            {"currency":"GBP","conversionRate":[
          {"rate": 0.0185197704},
          {"rate": -0.2814802296},
          {"rate": -0.6814802296},
          {"rate": -0.7814802296},
          {"rate": -0.1814802296},
          {"rate": -0.5814802296},
          {"rate": -0.1814802296},
          {"rate": -0.2814802296},
          {"rate": -0.8814802296},
          {"rate": -0.3814802296},
          {"rate": -0.3814802296},
          {"rate": -0.4814802296},
          {"rate": -0.7814802296},
          {"rate": -0.6814802296},
          {"rate": -0.0814802296},
          {"rate": -0.0814802296}
        ],"validFrom":"2016-05-06T00:00:00.0000000+01:00","validTo":"2016-05-07T00:00:00.0000000+01:00"}
    ]
}

 
]
module.exports = {
    getRates: function(req, res, next){

        request('https://httpbin.org/get', function (error, response, body) {
          if (!error && response.statusCode == 200) {


            var newData = {};
            
            data.forEach(function(currency, index) {

                var rates = {};

                currency.exchangeRates.forEach(function(rate) {
                    rates[rate.currency] = rate.conversionRate[0].rate.toFixed(4);
                });

                newData[currency.currency] = rates;
            });     

            res.locals.currentRates = newData;
            return next();

          } else {

            console.log('Bleeding errr');
            return next()

          }
        })
    }
}